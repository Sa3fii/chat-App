{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from 'axios';\nimport { useContext, useEffect, useState } from 'react';\nimport { socket } from '../../../socket';\nimport dayjs from 'dayjs';\nimport { AppAuthContext } from '../../../core/contexts/AppAuthProvider';\nimport { AppNotifContext } from '../../../core/contexts/AppNotifProvider';\nconst useChat = (friend, user) => {\n  _s();\n  const [messages, setmessages] = useState([]);\n  const [isLoading, setisLoading] = useState(true);\n  const [error, seterror] = useState();\n  const [msgLoading, setmsgLoading] = useState(false);\n  const [msgError, setmsgError] = useState();\n  const [msg, setMsg] = useState('');\n  const {\n    setNotifList,\n    setNotifRead\n  } = useContext(AppNotifContext);\n  const getMessages = async () => {\n    try {\n      setisLoading(true);\n      seterror();\n      const result = await axios.get('http://localhost:5005/message', {\n        params: {\n          user: user.id,\n          friend\n        }\n      });\n      if (result.data) {\n        setmessages(result.data.data);\n      }\n    } catch (error) {\n      var _error$response;\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data.statusCode) == 7004) {\n        setmessages([]);\n      } else seterror('An error has occured');\n    } finally {\n      setisLoading(false);\n    }\n  };\n  const sendMessage = async () => {\n    try {\n      setmsgLoading(true);\n      setmsgError();\n      const result = await axios.post('http://localhost:5005/message', {\n        sender: user.id,\n        receiver: friend,\n        content: msg,\n        date: dayjs()\n      });\n      if (result.data) {\n        socket.emit('send_message', {\n          dest: friend,\n          msg: result.data.data\n        });\n        setmessages(previous => [result.data.data, ...previous]);\n      }\n    } catch (error) {\n      console.log(error);\n      setmsgError(\"An error has occured\");\n    } finally {\n      setmsgLoading(false);\n    }\n  };\n  const handleSend = e => {\n    e.preventDefault();\n    msg && sendMessage();\n    setMsg('');\n  };\n  useEffect(() => {\n    getMessages();\n    setNotifRead(friend);\n  }, [friend]);\n  useEffect(() => {\n    // Socket receive\n    function onMessageRec(data) {\n      if (data.sender == friend) {\n        setmessages(previous => [data, ...previous]);\n      } else {\n        setNotifList(data.sender);\n      }\n    }\n    socket.on('receive_message', onMessageRec);\n    return () => {\n      socket.off('receive_message', onMessageRec);\n    };\n  }, [friend]);\n  return {\n    messages,\n    isLoading,\n    error,\n    handleSend,\n    setMsg,\n    msgLoading,\n    msgError,\n    user\n  };\n};\n_s(useChat, \"H/psbVRtk2y+b56+qLGJDBs+GNQ=\");\nexport default useChat;","map":{"version":3,"names":["axios","useContext","useEffect","useState","socket","dayjs","AppAuthContext","AppNotifContext","useChat","friend","user","_s","messages","setmessages","isLoading","setisLoading","error","seterror","msgLoading","setmsgLoading","msgError","setmsgError","msg","setMsg","setNotifList","setNotifRead","getMessages","result","get","params","id","data","_error$response","response","statusCode","sendMessage","post","sender","receiver","content","date","emit","dest","previous","console","log","handleSend","e","preventDefault","onMessageRec","on","off"],"sources":["/home/saafi/Desktop/Personal/websock/front/src/pages/chat/logic/useChat.js"],"sourcesContent":["import axios from 'axios'\nimport { useContext, useEffect, useState } from 'react'\nimport { socket } from '../../../socket'\nimport dayjs from 'dayjs'\nimport { AppAuthContext } from '../../../core/contexts/AppAuthProvider'\nimport { AppNotifContext } from '../../../core/contexts/AppNotifProvider'\n\nconst useChat = (friend, user) => {\n\n    const [messages, setmessages] = useState([])\n    const [isLoading, setisLoading] = useState(true)\n    const [error, seterror] = useState()\n    const [msgLoading, setmsgLoading] = useState(false)\n    const [msgError, setmsgError] = useState()\n    const [msg, setMsg] = useState('');\n\n\n    const { setNotifList, setNotifRead } = useContext(AppNotifContext)\n\n    const getMessages = async () => {\n        try {\n            setisLoading(true)\n            seterror()\n\n            const result = await axios.get('http://localhost:5005/message', { params: { user: user.id, friend } });\n            if (result.data ) {\n                setmessages(result.data.data)\n            } \n        } catch (error) {\n            if (error.response?.data.statusCode == 7004) {\n                setmessages([])\n            } else seterror('An error has occured')\n        } finally {\n            setisLoading(false)\n        }\n    };\n\n    const sendMessage = async () => {\n        try {\n            setmsgLoading(true)\n            setmsgError()\n\n            const result = await axios.post('http://localhost:5005/message', { sender: user.id, receiver: friend, content: msg, date: dayjs() });\n            if (result.data) {\n                socket.emit('send_message', { dest: friend, msg: result.data.data });\n                setmessages(previous => [result.data.data, ...previous]);\n            }\n        } catch (error) {\n            console.log(error);\n            setmsgError(\"An error has occured\")\n        } finally {\n            setmsgLoading(false)\n        }\n    }\n\n    const handleSend = (e) => {\n        e.preventDefault();\n        msg && sendMessage();\n        setMsg('')\n\n    }\n    useEffect(() => {\n        getMessages()\n        setNotifRead(friend)\n    }, [friend])\n\n    useEffect(() => {\n\n        // Socket receive\n        function onMessageRec(data) {\n            if (data.sender == friend) {\n                setmessages(previous => [data, ...previous]);\n            }\n            else {\n                setNotifList(data.sender)\n            }\n        }\n\n        socket.on('receive_message', onMessageRec);\n\n        return () => {\n            socket.off('receive_message', onMessageRec);\n        }\n    }, [friend])\n\n    return {\n        messages,\n        isLoading,\n        error,\n        handleSend,\n        setMsg,\n        msgLoading,\n        msgError,\n        user\n\n    }\n}\n\nexport default useChat"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}